digital-ba-auth-service:
  fullnameOverride: "ba-auth"

  image:
    registry: binaryrepo.azure.nbscloud.co.uk/daidigital-a995daidigital-docker-dev
    repository: nationwide.digitalbanking.baauthorchestration
    tag: <+stage.variables.image_tag>
    pullPolicy: Always

  # Allow traffic only from ingress-nginx
  networkPolicy:
    ingress:
      default:
        config:
          - namespaceSelector:
              matchLabels:
                kubernetes.io/metadata.name: ingress-nginx
        ports:
          - 8080
    egress: {}

  # üîê Service Account + Vault Auth
  serviceAccount:
    create: true
    name: banking-gateway-sa
    enableKubernetesVaultAuth: true

  # üîê Vault Injector annotations (ADDED)
  podAnnotations:
    vault.hashicorp.com/agent-inject: "true"
    vault.hashicorp.com/role: "banking-gateway-role"

    vault.hashicorp.com/agent-inject-secret-client.pfx: "secrets/data/certs/ca"
    vault.hashicorp.com/agent-inject-template-client.pfx: |
      {{- with secret "secrets/data/certs/ca" -}}
      {{ .Data.data.DUClientDEV-BA.pfx }}
      {{- end }}

  envs:
    API_BASE_URL: baauthorchestration.mc-digital.dev.azure.nbscloud.co.uk

  service:
    port: 80
    targetPort: 8080

  ingressMultipleEnabled: true

  ingressMultiple:
    - name: dbg
      className: nginx
      annotations:
        nginx.ingress.kubernetes.io/force-ssl-redirect: "false"
        nginx.ingress.kubernetes.io/backend-protocol: HTTP
        nginx.ingress.kubernetes.io/enable-underscores-in-headers: "true"
        nginx.ingress.kubernetes.io/hsts: "false"
      tls:
        - hosts:
            - baauthorchestration.mc-digital.dev.azure.nbscloud.co.uk
          secretName: dbg
      rules:
        - host: baauthorchestration.mc-digital.dev.azure.nbscloud.co.uk
          paths:
            - path: /
              pathType: ImplementationSpecific
              service:
                name: dbg
                port: 80

  ingress:
    enabled: false

  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 3
    targetCPUUtilizationPercentage: 80

  securityContext:
    runAsUser: 1654
    runAsNonRoot: true
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop:
        - ALL

  livenessProbe: null
  readinessProbe: null

  tolerations:
    - key: "nodepooltype"
      operator: "Equal"
      value: "application"
      effect: "NoSchedule"
